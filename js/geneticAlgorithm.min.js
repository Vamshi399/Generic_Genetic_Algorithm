function Element(t,e,n){this.id=t,this.chromosome=e,this.fitness=n,this.probability=0,this.getId=function(){return this.id},this.getChromosome=function(){return this.chromosome.slice()},this.getFitness=function(){return this.fitness},this.getProbability=function(){return this.probability},this.setId=function(t){this.id=t},this.setChromosome=function(t){this.chromosome=t.slice()},this.setFitness=function(t){this.fitness=t},this.setProbability=function(t){this.probability=t},this.setGen=function(t,e){this.chromosome[t]=e.slice()},this.getGen=function(t){return this.chromosome[t].slice()},this.write=function(){var t="";t+="Id: "+this.id,t+="	Chromosome: ";for(var e=0;e<this.chromosome.length;e++)t+=this.chromosome[e]+" ";return t+="	Fitness: "+this.fitness,t+="	Probability: "+Math.round(100*this.probability)/100}}function Functions(){function t(t,e){for(var n=[],t=e.length,i=e.slice(),o=0;t>o;o++){var s=Math.floor(Math.random()*i.length);n[o]=i[s],i.splice(s,1)}return new Element(1,n.slice(),0)}function e(t){var e=new Element(t.getId(),t.getChromosome(),t.getFitness());return e.setProbability(t.getProbability()),e}function n(t){for(var n=[],i=0;i<t.length;i++)n[i]=e(t[i]);return n}that=this,this.initialization=function(t,e,n,i){var o=[],s=[];if(i)for(var r=0;t>r;r++){for(var a=0;e>a;a++)s[a]=n[Math.floor(Math.random()*n.length)];o[r]=new Element(r,s.slice(),0)}else if(n.length>=e)for(var r=0;t>r;r++){auxGenes=n.slice();for(var a=0;e>a;a++){var h=Math.floor(Math.random()*auxGenes.length);s[a]=auxGenes[h],auxGenes.splice(h,1)}o[r]=new Element(r,s.slice(),0)}else console.log("There are not enough different genes that do not occur in a chromosome, given the size of the chromosome");return o},this.isValid=function(t){return!0},this.isValidRoute=function(t){for(var e=t.chromosome.slice().sort(),n=0;n<e.length-1;n++)if(0==e[n].localeCompare(e[n+1]))return!1;return!0},this.fitnessFunction=function(t,e){for(var n=0,i=0;i<t.getChromosome().length;i++)0==t.getChromosome()[i].localeCompare("1")&&n++;return n},this.fitnessRouteFunction=function(t,e){for(var n=0,i=0;i<t.getChromosome().length-1;i++){var o=t.getChromosome()[i],s=t.getChromosome()[i+1];n+=e[o].distances[s].distance}return n=-2*n},this.evaluate=function(t,e){var i=[];i=n(t);for(var o=0;o<i.length;o++)i[o].setFitness(this.fitnessFunction(i[o],e));return i},this.rouletteWheelSelection=function(t){var e=[],i=[];e=n(t),sumFitness=0;for(var o=0;o<e.length;o++)sumFitness+=e[o].getFitness();for(var o=0;o<e.length;o++)e[o].setProbability(e[o].getFitness()/sumFitness);e.sort(function(t,e){return t.getProbability()-e.getProbability()});for(var o=1;o<e.length;o++)e[o].setProbability(e[o].getProbability()+e[o-1].getProbability());for(var o=0;o<e.length;o++)for(var s=Math.random(),r=0;r<e.length;r++)if(s<=e[r].getProbability()){i[o]=new Element(e[r].getId(),e[r].getChromosome(),e[r].getFitness());break}return i},this.crossover=function(t,i,o,s){function r(t,e){for(var n=[],i=0;i<t.getChromosome().length/2;)n[i]=t.getChromosome()[i],i++;for(;i<e.getChromosome().length;)n[i]=e.getChromosome()[i],i++;return n}var a=[],h=n(i),l=Math.floor(t.length*(100-o)/100);h.sort(function(t,e){return e.getFitness()-t.getFitness()});for(var u=0;l>u;u++)a[u]=e(h[u]);for(var u=l;u<t.length-1;u++)a[u]=new Element(u,r(t[u],t[u+1]),0);return a[u]=new Element(u,r(t[t.length-1],t[0]),0),a},this.randomOverNoValidCrossover=function(i,o,s,r){function a(t,e){for(var n=[],i=0;i<t.getChromosome().length/2;)n[i]=t.getChromosome()[i],i++;for(;i<e.getChromosome().length;)n[i]=e.getChromosome()[i],i++;return n}var h=[],l=n(o),u=Math.floor(i.length*(100-s)/100);l.sort(function(t,e){return e.getFitness()-t.getFitness()});for(var c=0;u>c;c++)h[c]=e(l[c]);for(var c=u;c<i.length-1;c++)h[c]=new Element(c,a(i[c],i[c+1]),0);h[c]=new Element(c,a(i[i.length-1],i[0]),0);for(var c=0;c<h.length;c++)this.isValid(h[c])||(h[c]=t(h[c].getChromosome().length,r));return h},this.mutation=function(t,e,i){var o=[];o=n(t);for(var s=0;s<o.length;s++)if(Math.random()<e/100){var r=Math.round(Math.random()*(o[s].getChromosome().length-1));do var a=i[Math.round(Math.random()*(i.length-1))];while(0==a.localeCompare(o[s].getChromosome()[r]));o[s].setGen(r,a)}return o},this.evolution=function(t){var e=[];return e=n(t)},this.allValidsEvolution=function(t){var i=[];sortedParents=n(this.getParents()),sortedParents.sort(function(t,e){return t.getFitness()-e.getFitness()}),i=n(sortedParents);for(var o=0,s=0;o<t.length;o++)this.isValid(t[o])&&(i[s]=e(t[o]),s++);return i},this.printPopulation=function(t){for(var e="",n=0;n<t.length;n++)e+=t[n].write()+"\n";return e}}function GeneticAlgorithm(t){that=this,this.tabla=t.tabla,this.population=[],this.parents=[],this.children=[],this.best=Object,this.generation=0,this.initialization=t.initialization,this.isValid=t.isValid,this.fitnessFunction=t.fitnessFunction,this.evaluate=t.evaluation,this.selection=t.selection,this.crossover=t.crossover,this.mutation=t.mutation,this.evolution=t.evolution,this.initialize=function(){that.setPopulation(that.initialization(t.popSize,t.chromosomeSize,t.genes,t.repeated))},this.simulateGeneration=function(){0==that.getPopulation().length?console.log("There arenâ€™t elements in the population, it must be initialized first"):(that.setPopulation(that.evaluate(that.getPopulation(),that.tabla)),that.setParents(that.selection(that.getPopulation())),that.setChildren(that.crossover(that.getParents(),that.getPopulation(),t.percentCrossOver,t.genes)),that.setPopulation(that.getChildren()),that.setPopulation(that.mutation(that.getPopulation(),t.percentMutation,t.genes)),that.setPopulation(that.evolution(that.getPopulation())),that.setPopulation(that.evaluate(that.getPopulation(),that.tabla)),that.setGeneration(that.getGeneration()+1),that.setBest(that.bestElement(that.getPopulation())))},this.simulateConditionalGeneration=function(t){for(;that.getGeneration()<t;)that.simulateGeneration();return that.getBest()},this.simulateConditionalTime=function(t){for(var e=(new Date).getTime(),n=(new Date).getTime(),i=0;t>i;)that.simulateGeneration(),n=(new Date).getTime(),i=n-e;return that.getBest()},this.simulateConditionalFitness=function(t){for(that.simulateGeneration();that.getBest().getFitness()<t;)that.simulateGeneration();return that.getBest()},this.printPopulation=function(t){for(var e="",n=0;n<t.length;n++)e+=t[n].write()+"\n";return e},this.bestElement=function(t){function e(t){for(var e=Object,n=!1,i=0;i<t.length;i++)if(that.isValid(t[i])){n=!0,e=that.cloneElement(t[i]);break}return n||console.log("There is no valid element in this generation"),e}var n=Object,i=[];i=this.clonePopulation(t),i=this.evaluate(i,that.tabla),n=this.cloneElement(e(i));for(var o=0;o<i.length;o++)this.isValid(i[o])&&i[o].getFitness()>n.getFitness()&&(n=this.cloneElement(i[o]));return n},this.cloneElement=function(t){var e=new Element(t.getId(),t.getChromosome(),t.getFitness());return e.setProbability(t.getProbability()),e},this.clonePopulation=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=this.cloneElement(t[n]);return e},this.fitnessMean=function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n].getFitness();return e/=t.length},this.getPopulation=function(){var t=this.clonePopulation(this.population);return t},this.getParents=function(){var t=this.clonePopulation(this.parents);return t},this.getChildren=function(){var t=this.clonePopulation(this.children);return t},this.getBest=function(){var t=this.cloneElement(this.best);return t},this.getGeneration=function(){return this.generation},this.setPopulation=function(t){var e=this.clonePopulation(t);this.population=e},this.setParents=function(t){var e=this.clonePopulation(t);this.parents=e},this.setChildren=function(t){var e=this.clonePopulation(t);this.children=e},this.setBest=function(t){var e=this.cloneElement(t);this.best=e},this.setGeneration=function(t){this.generation=t}}